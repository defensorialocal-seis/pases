<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Registro de pases Operador</title>
<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#2563eb;
    --danger:#ef4444;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:
      linear-gradient(180deg, rgba(37,99,235,0.06), transparent 120px),
      var(--bg);
    color:#0f172a;
    padding:18px;
    -webkit-font-smoothing:antialiased;
  }

  header{
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    margin-bottom:14px;
  }
  header h1{margin:0;font-size:1.15rem;}
  header .controls{display:flex;gap:8px;align-items:center;}

  .container{
    display:grid;
    grid-template-columns: 360px 1fr;
    gap:16px;
    align-items:start;
  }

  /* Left panel (form) */
  .card{
    background:var(--card);
    border-radius:10px;
    padding:14px;
    box-shadow: 0 6px 18px rgba(12,18,35,0.06);
  }
  form .row{
    display:flex;
    gap:8px;
    margin-bottom:8px;
    align-items:center;
  }
  label{font-size:0.8rem;color:var(--muted);display:block;margin-bottom:6px}
  input[type="text"], input[type="date"], select, textarea{
    width:100%;
    padding:8px 10px;
    border-radius:8px;
    border:1px solid #e6edf3;
    background:transparent;
    font-size:0.95rem;
  }
  textarea{min-height:70px;resize:vertical;padding-top:10px}
  .small{font-size:0.85rem;color:var(--muted)}
  button{
    background:var(--accent);
    color:white;
    border:none;
    padding:10px 12px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
  }
  button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(37,99,235,0.12)}
  button.danger{background:var(--danger)}
  .actions{display:flex;gap:8px;justify-content:space-between;align-items:center;margin-top:10px}

  /* Right panel (table/list) */
  .toolbar{display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap}
  .table{
    width:100%;
    border-collapse:collapse;
    border-radius:10px;
    overflow:hidden;
  }
  .table thead{
    background:#0f172a; /* azul oscuro sólido */
    color:white;
    font-weight:700;
  }
  .table th, .table td{
    padding:10px 12px;
    border-bottom:1px solid #eef2f7;
    text-align:left;
    vertical-align:top;
    font-size:0.95rem;
  }
  .table tbody tr:hover{background:#fbfdff}
  .chip{
    display:inline-block;padding:6px 8px;border-radius:999px;background:#eef2ff;color:#0b4bd8;font-size:0.85rem;margin-right:6px;
  }
  .muted{color:var(--muted);font-size:0.9rem}

  .flex{display:flex;gap:8px;align-items:center}
  .grow{flex:1}

  /* Responsive */
  @media (max-width:980px){
    .container{grid-template-columns:1fr; }
    header{gap:8px;flex-direction:column;align-items:flex-start}
  }

  /* modal */
  .modal-back{
    position:fixed;inset:0;background:rgba(3,7,18,0.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:50;
  }
  .modal{
    width:100%;max-width:820px;background:var(--card);border-radius:12px;padding:14px;box-shadow:0 12px 40px rgba(2,6,23,0.5)
  }
  .modal.show{display:flex}

  /* printable view tweak */
  @media print{
    body{background:white;padding:0}
    header, .actions, .toolbar, .modal-back{display:none}
    .card{box-shadow:none;border-radius:0}
    .table th, .table td{font-size:12pt}
  }
</style>
</head>
<body>
<header>
  <div>
    <h1>Registro de Pases Operador</h1>
    <div class="small">Operador Defensoria Civil y Comercial 6 Poder Judicial de Misiones</div>
  </div>
  <div class="controls"></div>
</header>

<div class="container">
  <!-- FORM -->
  <aside class="card" aria-label="Formulario de registro">
    <form id="cause-form">
      <input type="hidden" id="cause-id">
      <label for="expediente">Número de Expte *</label>
      <input id="expediente" type="text" placeholder="Ej: 12345/2025" required>

      <label for="caratula">Carátula *</label>
      <input id="caratula" type="text" placeholder="Carátula del expediente" required>

      <label for="tipo">Tipo de proceso *</label>
      <select id="tipo" required>
        <option value="">-- Seleccionar --</option>
        <option value="Civil">Civil</option>
        <option value="Laboral">Laboral</option>
        <option value="Familia">Familia</option>
        <option value="Violencia Familiar">Violencia Familiar</option>
        <option value="Administrativo: Cejume">Administrativo: Cejume</option>
        <option value="Administrativo: DEUT">Administrativo: DEUT</option>
      </select>

      <label for="personal">Personal asignado</label>
      <select id="personal" required>
        <option value="">-- Seleccionar --</option>
        <option>Bazante Nadia Romina</option>
        <option>Boillat Cesar Enrique</option>
        <option>Cardozo Maria Raquel</option>
        <option>Cedron Noelia Aurora</option>
        <option>Corrales Alicia Mariela</option>
        <option>Escobar Monica Graciela</option>
        <option>Fioravante Romulo</option>
        <option>Gonzalez Alberto Misael</option>
        <option>Gonzalez Juan Jose</option>
        <option>Gudiño Natalia Esther</option>
        <option>Magnani Enzo Luciano</option>
        <option>Pablos Patricia</option>
        <option>Palacios Ana Gabriela</option>
        <option>Ortega Lucia Noemi</option>
        <option>Ramos Marcelo Gustavo</option>
        <option>Riveros Patricia Soledad</option>
        <option>Sosa Rita Cecilia</option>
      </select>

      <label for="fecha-pase">Fecha de pase a proveer *</label>
      <input id="fecha-pase" type="date" required>

      <hr style="margin:12px 0;border:none;border-top:1px solid #eef2f7">

      <label>Devolución a Mesa de Entradas</label>
      <input id="devol-motivo" type="text" placeholder="Motivo (opcional)">
      <input id="devol-fecha" type="date" placeholder="Fecha devolución">

      <label style="margin-top:8px">Remisión a otra Defensoría</label>
      <input id="rem-detalle" type="text" placeholder="Detalle (opcional)">
      <input id="rem-fecha" type="date" placeholder="Fecha remisión">

      <label style="margin-top:8px">Causas vinculadas por cuerda</label>
      <select id="vinculadas" multiple></select>
      <div class="small" style="margin-bottom:8px">Mantén Ctrl/Cmd para seleccionar múltiples. Selecciona aquí expedientes ya registrados.</div>

      <label>Causas acumuladas</label>
      <select id="acumuladas" multiple></select>
      <div class="small">Se guardan como relaciones internas entre expedientes.</div>

      <div class="actions">
        <div style="display:flex;gap:8px">
          <button type="submit" id="save-btn">Guardar</button>
          <button type="button" id="reset-btn" class="ghost">Limpiar</button>
        </div>
        <div class="muted" id="form-tip">Campos con * obligatorios</div>
      </div>
    </form>
  </aside>

  <!-- LIST -->
  <main>
    <div class="card">
      <div class="toolbar">
        <input id="search" type="text" placeholder="Buscar por expte, carátula, personal..." class="grow" />
        <select id="filter-tipo"><option value="">Todos los tipos</option>
          <option>Civil</option><option>Laboral</option><option>Familia</option><option>Violencia Familiar</option>
          <option>Administrativo: Cejume</option><option>Administrativo: DEUT</option>
        </select>
        <select id="filter-personal"><option value="">Todos los personales</option></select>
        <label for="filter-date-from" class="small" style="margin:0">Desde</label>
        <input id="filter-date-from" type="date" style="width:140px">
        <label for="filter-date-to" class="small" style="margin:0">Hasta</label>
        <input id="filter-date-to" type="date" style="width:140px">
        <button id="print-all" class="ghost">Imprimir lista</button>
      </div>

      <div style="overflow:auto">
      <table class="table" id="causes-table">
        <thead>
          <tr>
            <th>Expte</th>
            <th>Carátula / Tipo</th>
            <th>Personal / Pase</th>
            <th>Vinculadas / Acumuladas</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
      </div>
    </div>
  </main>
</div>

<!-- Modal para ver/imprimir registro -->
<div class="modal-back" id="modal-back">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <h3 id="modal-title" style="margin:0">Vista de Causa</h3>
      <div style="display:flex;gap:8px">
        <button id="modal-print" class="ghost">Imprimir</button>
        <button id="modal-close" class="ghost">Cerrar</button>
      </div>
    </div>
    <div id="modal-content" style="font-size:0.95rem;line-height:1.5"></div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>

<script>
/* =========================
   CONFIGURACIÓN FIREBASE
   ========================= */
const firebaseConfig = {
  apiKey: "AIzaSyDRO3TWNgHDUpOqB0FfyquxRdRJdg-WFNM",
  authDomain: "pase-operador.firebaseapp.com",
  projectId: "pase-operador",
  storageBucket: "pase-operador.firebasestorage.app",
  messagingSenderId: "1059978202214",
  appId: "1:1059978202214:web:c70563ac36ce2025fc71a7",
  databaseURL: "https://pase-operador-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let causes = [];

const $ = sel => document.querySelector(sel);
const formatDate = iso => {
  if(!iso) return '';
  const d = new Date(iso);
  if (isNaN(d)) return iso;
  return `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
};

function attachRealtimeListener(){
  db.ref('causes').on('value', snap => {
    causes = Object.values(snap.val()||{}).sort((a,b)=>(a.expediente||'').localeCompare(b.expediente||''));
    refreshSelects();
    refreshTable();
  });
}

async function saveCause(obj){ await db.ref('causes/'+obj.id).set(obj); }
async function deleteCause(id){ await db.ref('causes/'+id).remove(); }

const inputs = {
  id: $('#cause-id'), expediente: $('#expediente'), caratula: $('#caratula'),
  tipo: $('#tipo'), personal: $('#personal'), fechaPase: $('#fecha-pase'),
  devolMotivo: $('#devol-motivo'), devolFecha: $('#devol-fecha'),
  remDetalle: $('#rem-detalle'), remFecha: $('#rem-fecha'),
  vinculadas: $('#vinculadas'), acumuladas: $('#acumuladas')
};

function refreshSelects(){
  const options = causes.map(c => ({value:c.id,text:`${c.expediente} — ${c.caratula}`}));
  [inputs.vinculadas,inputs.acumuladas].forEach(sel=>{
    sel.innerHTML=''; options.forEach(o=>{let opt=document.createElement('option');opt.value=o.value;opt.textContent=o.text;sel.appendChild(opt);});
  });
  const personalFilter=$('#filter-personal');
  personalFilter.innerHTML='<option value="">Todos los personales</option>';
  [...new Set(causes.map(c=>(c.personal||'').trim()).filter(Boolean))].sort().forEach(p=>{
    let opt=document.createElement('option');opt.value=p;opt.textContent=p;personalFilter.appendChild(opt);
  });
}

function renderRow(c){
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td><strong>${escapeHtml(c.expediente)}</strong></td>
    <td><div>${escapeHtml(c.caratula)||'<span class="muted">—</span>'}</div><div class="small chip">${escapeHtml(c.tipo)}</div></td>
    <td><div>${escapeHtml(c.personal)||'<span class="muted">—</span>'}</div><div class="small">${formatDate(c.fechaPase)}</div></td>
    <td><div class="small"><strong>Vinc:</strong> ${(c.vinculadas||[]).join(', ')||'<span class="muted">—</span>'}</div>
        <div class="small" style="margin-top:6px"><strong>Acum:</strong> ${(c.acumuladas||[]).join(', ')||'<span class="muted">—</span>'}</div></td>
    <td><div class="flex"><button class="ghost btn-view" data-id="${c.id}">Ver</button><button class="ghost btn-edit" data-id="${c.id}">Editar</button><button class="danger btn-delete" data-id="${c.id}">Eliminar</button></div></td>`;
  return tr;
}

function refreshTable(){
  const tbody=$('#table-body');tbody.innerHTML='';
  causes.forEach(c=>tbody.appendChild(renderRow(c)));
}

function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

(function init(){ attachRealtimeListener(); })();
</script>
</body>
</html>

